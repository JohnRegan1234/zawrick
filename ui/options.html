<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Zawrick Options</title>
    <!-- Remove all <style> blocks and use only the external CSS file -->
    <link rel="stylesheet" href="options.css">
</head>

<body>

    <div class="header">
        <img src="icons/icon64.png" alt="Zawrick Icon" />
        <h1>Zawrick</h1>
        <span class="version">v1.5</span>
    </div>

    <!-- Inline notification banner -->
    <div id="notification" class="notification">Settings saved</div>

    <!-- Status Bar -->
    <div id="status-bar" class="status-bar">
        <div class="status-indicator"></div>
        <span id="status-text"></span>
        <button class="refresh-btn" id="refresh-status">‚Üª</button>
    </div>
    <div class="help-box error" id="status-help">
        Anki isn't running or
        <a href="https://ankiweb.net/shared/info/2055492159" class="link styled-link" target="_blank">AnkiConnect</a>
        isn't enabled. Don't worry, new cards will be safe in your browser until Anki starts.<br />
    </div>

    <!-- Pending cards with tooltip -->
    <div class="pending-cards">
        <div class="muted-text" id="pending-summary">
            <span id="pending-count" class="pending-count">0</span> new cards pending sync to Anki
        </div>
    </div>

    <div class="section" id="anki-section">
        <div class="section-header">
            <div>
                <div class="section-title">‚öôÔ∏è Anki Settings</div>
                <div class="section-subtitle">Configure your Anki deck and note type</div>
            </div>
            <span class="section-toggle" tabindex="0" aria-label="Toggle section">‚ñæ</span>
        </div>
        <div class="section-body-wrapper">
            <div class="section-body" id="anki-body">
                <div class="section-body-content">
                    <div class="form-group">
                        <label class="form-label" for="anki-deck">Deck to use</label>
                        <select id="anki-deck" class="form-select"></select>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="anki-note-type">Note Model to use</label>
                        <select id="anki-note-type" class="form-select"></select>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- GPT Section -->
    <div class="section" id="gpt-section">
        <div class="section-header">
            <div>
                <div class="section-title">ü§ñ GPT Settings</div>
                <div class="section-subtitle">Configure AI question generation</div>
            </div>
            <span class="section-toggle" tabindex="0" aria-label="Toggle section">‚ñæ</span>
        </div>
        <div class="section-body-wrapper">
            <div class="section-body" id="gpt-body">
                <div class="section-body-content">
                    <label class="toggle-container">
                        <input type="checkbox" id="enable-gpt" class="toggle-checkbox">
                        <div class="toggle-switch">
                            <div class="toggle-slider"></div>
                        </div>
                        <span class="toggle-label">Enable GPT question generation</span>
                    </label>

                    <label class="toggle-container">
                        <input type="checkbox" id="always-confirm" class="toggle-checkbox">
                        <div class="toggle-switch">
                            <div class="toggle-slider"></div>
                        </div>
                        <span class="toggle-label">Always review cards before saving</span>
                    </label>
                    <div class="help-text">When enabled, you can review and edit GPT-generated content before saving to Anki.</div>

                    <div class="form-group">
                        <label class="form-label" for="openai-key">OpenAI API Key</label>
                        <div class="input-wrapper">
                            <input id="openai-key" type="password" class="form-input" placeholder="Paste your OpenAI key here"
                                autocomplete="off" />
                            <button type="button" class="input-addon" id="toggle-password" aria-label="Show/Hide API Key">üëÅÔ∏è
                            </button>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="prompt-select">Saved Prompts</label>
                        <select id="prompt-select" class="form-select"></select>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="profile-name">Name</label>
                        <input id="profile-name" type="text" class="form-input" />
                    </div>
                    <div class="form-group">
                        <div class="form-label-group">
                            <label class="form-label" for="gpt-prompt">Prompt Template</label>
                        </div>
                        <textarea id="gpt-prompt" rows="4" class="form-textarea" placeholder="e.g. Use {{text}} for the selected text, {{title}} for the page title, and {{url}} for the page URL.&#10;Example: Write a question for the front of an Anki card based on {{text}} from {{title}} ({{url}})."></textarea>
                    </div>
                    <div id="prompt-limit-msg" class="muted-text">
                        You can keep up to five prompts.
                    </div>

                    <div class="btn-row">
                        <button id="add-prompt" class="btn btn-primary">Add Prompt</button>
                        <button id="del-prompt" class="btn btn-secondary">Delete Prompt</button>
                        <button id="save-prompt" class="btn btn-primary">Save Prompt</button>
                    </div>

                    <div class="btn-row">
                        <button id="test-api" class="btn btn-secondary">Test API</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Prompt History Section -->
    <div class="section" id="history-section">
      <div class="section-header">
        <div>
          <div class="section-title">üìã Prompt History</div>
          <div class="section-subtitle">View prompts used to generate cards</div>
        </div>
        <span class="section-toggle" tabindex="0" aria-label="Toggle section">‚ñæ</span>
      </div>
      <div class="section-body-wrapper">
        <div class="section-body">
          <div class="section-body-content">
            <div class="history-controls">
              <button id="clear-history-btn" class="btn btn-secondary">Clear History</button>
              <span class="history-count count-badge" id="history-count"></span>
            </div>
            <div class="history-list" id="history-list">
              <!-- Example entry structure -->
              <div class="history-entry">
                <div class="history-header">
                  <!-- ...header content... -->
                </div>
                <div class="history-details">
                  <div class="history-detail-row">
                    <div class="history-detail-label">Prompt:</div>
                    <!-- ...prompt content... -->
                  </div>
                  <!-- ...other detail rows... -->
                </div>
              </div>
              <!-- ...repeat for each entry... -->
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- PDF Review Section -->
    <div class="section" id="pdf-review-section">
        <div class="section-header">
            <div>
                <div class="section-title">üìÑ PDF Cards for Review</div>
                <div class="section-subtitle">
                    Edit and save cards created from PDF selections<br>
                    <span class="help-text" style="font-size: 13px;">
                        Whether PDF cards go here or auto-save depends on the global <b>Always review cards</b> setting above.
                    </span>
                </div>
            </div>
            <span class="section-toggle" tabindex="0" aria-label="Toggle section">‚ñæ</span>
        </div>
        <div class="section-body-wrapper">
            <div class="section-body" id="pdf-review-body">
                <div class="section-body-content">
                    <div class="history-controls">
                        <button id="refresh-pdf-review-list-btn" class="btn btn-secondary">Refresh List</button>
                        <button id="clear-pdf-history" class="btn btn-secondary error">Clear All PDF Cards</button>
                        <span class="history-count count-badge" id="pdf-review-count">0 cards for review</span>
                    </div>
                    <p class="help-text" style="margin-bottom: var(--gap-sm);">
                        Note: PDF-sourced cards appear here for review if the global "Always review cards before saving" setting (in GPT Settings above) is enabled, or if automatic processing encountered an issue. If that setting is disabled and processing is successful, PDF cards are sent directly to Anki (or the sync queue) with a system notification.
                    </p>
                    <div id="pdf-review-list" class="history-list">
                        <div style="text-align: center; color: var(--muted); padding: 20px;">Loading PDF cards for review...</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Move the minimal GPT info block to just above the footer, single line, smaller font -->
    <div class="gpt-info-minimal-inline">
        <span class="gpt-model-pill-minimal-inline">gpt-3.5-turbo</span>
        <span class="gpt-info-separator">|</span>
        <a href="https://platform.openai.com/api-keys" class="gpt-key-link-minimal-inline" target="_blank">Get an OpenAI API key</a>
    </div>

    <div class="footer">
      <a href="https://github.com/JohnRegan1234/zawrick/issues" target="_blank" rel="noopener" class="footer-link">üêû Report a bug</a>
      <button type="button" id="reset-settings" class="footer-link">Reset settings</button>
    </div>

    <script src="../options.js" defer></script>
    <script src="../options_ui.js" defer></script>
</body>
</html>