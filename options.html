<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>bronki</title>
    <!-- Remove all <style> blocks and use only the external CSS file -->
    <link rel="stylesheet" href="options.css">
</head>

<body>

    <div class="header">
        <img src="icons/icon64.png" alt="Zawrick Icon" />
        <h1>Zawrick</h1>
        <span class="version">v1.3</span>
    </div>

    <!-- Inline notification banner -->
    <div id="notification" class="notification">Settings saved</div>

    <!-- Status Bar -->
    <div id="status-bar" class="status-bar">
        <div class="status-indicator"></div>
        <span id="status-text"></span>
        <button class="refresh-btn" id="refresh-status">‚Üª</button>
    </div>
    <div class="help-box error" id="status-help">
        Anki isn't running or <a href="https://ankiweb.net/shared/info/2055492159" class="link" target="_blank">
            <a href="https://ankiweb.net/shared/info/2055492159" class="link styled-link" target="_blank">AnkiConnect</a> isn't enabled. Don't worry, new cards will be safe in your browser until Anki starts.<br />
    </div>

    <!-- Pending cards with tooltip -->
    <div class="pending-cards">
        <div class="muted-text" id="pending-summary">
            <span id="pending-count" class="pending-count">0</span> new cards pending sync to Anki
        </div>
    </div>

    <div class="section" id="anki-section">
        <div class="section-header">
            <div>
                <div class="section-title">‚öôÔ∏è Anki Settings</div>
                <div class="section-subtitle">Configure your Anki deck and note type</div>
            </div>
            <span class="section-toggle" tabindex="0" aria-label="Toggle section">‚ñæ</span>
        </div>
        <div class="section-body-wrapper">
            <div class="section-body" id="anki-body">
                <div class="section-body-content">
                    <div class="form-group">
                        <label class="form-label" for="anki-deck-custom-trigger">Deck to use</label>
                        <div class="custom-select-wrapper" id="anki-deck-custom-wrapper">
                            <button type="button" id="anki-deck-custom-trigger" class="form-input custom-select-trigger" aria-haspopup="listbox" aria-expanded="false">
                                <span id="anki-deck-selected-value" class="selected-value"></span>
                                <span class="custom-select-arrow"></span>
                            </button>
                            <div id="anki-deck-options" class="custom-select-options" role="listbox" style="display: none;"></div>
                        </div>
                        <select id="anki-deck" class="form-select" style="display: none;"></select>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="anki-note-type-custom-trigger">Note Model to use</label>
                        <div class="custom-select-wrapper" id="anki-note-type-custom-wrapper">
                            <button type="button" id="anki-note-type-custom-trigger" class="form-input custom-select-trigger" aria-haspopup="listbox" aria-expanded="false">
                                <span id="anki-note-type-selected-value" class="selected-value"></span>
                                <span class="custom-select-arrow"></span>
                            </button>
                            <div id="anki-note-type-options" class="custom-select-options" role="listbox" style="display: none;"></div>
                        </div>
                        <select id="anki-note-type" class="form-select" style="display: none;"></select>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- GPT Section -->
    <div class="section" id="gpt-section">
        <div class="section-header">
            <div>
                <div class="section-title">ü§ñ GPT Settings</div>
                <div class="section-subtitle">Configure AI question generation</div>
            </div>
            <span class="section-toggle" tabindex="0" aria-label="Toggle section">‚ñæ</span>
        </div>
        <div class="section-body-wrapper">
            <div class="section-body" id="gpt-body">
                <div class="section-body-content">
                    <label class="toggle-container">
                        <input type="checkbox" id="enable-gpt" class="toggle-checkbox">
                        <div class="toggle-switch">
                            <div class="toggle-slider"></div>
                        </div>
                        <span class="toggle-label">Enable GPT question generation</span>
                    </label>

                    <label class="toggle-container">
                        <input type="checkbox" id="always-confirm" class="toggle-checkbox">
                        <div class="toggle-switch">
                            <div class="toggle-slider"></div>
                        </div>
                        <span class="toggle-label">Always review cards before saving</span>
                    </label>
                    <div class="help-text">When enabled, you can review and edit GPT-generated content before saving to Anki.</div>

                    <div class="form-group">
                        <label class="form-label" for="openai-key">OpenAI API Key</label>
                        <div class="input-wrapper">
                            <input id="openai-key" type="password" class="form-input" placeholder="Paste your OpenAI key here"
                                autocomplete="off" />
                            <button type="button" class="input-addon" id="toggle-password" aria-label="Show/Hide API Key">üëÅÔ∏è
                            </button>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="prompt-select">Saved Prompts</label>
                        <select id="prompt-select" class="form-select"></select>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="profile-name">Name</label>
                        <input id="profile-name" type="text" class="form-input" />
                    </div>
                    <div class="form-group">
                        <div class="form-label-group">
                            <label class="form-label" for="gpt-prompt">Prompt Template</label>
                            <button type="button" id="toggle-prompt-help" class="info-button" aria-expanded="false" aria-controls="prompt-help-content">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16" class="info-icon">
                                  <path d="M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16zm.93-9.412-1 4.705c-.07.34.029.533.304.533.194 0 .487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703 0-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381 2.29-.287zM8 5.5a1 1 0 1 1 0-2 1 1 0 0 1 0 2z"/>
                                </svg>
                                <span class="sr-only">Show prompt formatting help</span>
                            </button>
                        </div>
                        <div id="prompt-help-content" class="collapsible-help" hidden>
                            <div class="help-text">
                                Use placeholders like <code class="template-var">{{text}}</code> (selected text),
                                <code class="template-var">{{title}}</code> (page title), and
                                <code class="template-var">{{url}}</code> (page URL) in your template.
                                This allows the extension to dynamically insert the relevant information from the web page into your prompt.
                            </div>
                        </div>
                        <textarea id="gpt-prompt" rows="4" class="form-textarea"></textarea>
                    </div>
                    <div id="prompt-limit-msg" class="muted-text">
                        You can keep up to five prompts.
                    </div>

                    <div class="btn-row">
                        <button id="add-prompt" class="btn btn-primary">Add Prompt</button>
                        <button id="del-prompt" class="btn btn-secondary">Delete Prompt</button>
                        <button id="save-prompt" class="btn btn-primary">Save Prompt</button>
                    </div>

                    <div class="muted-text centered-text">
                        We will use <i>gpt-3.5-turbo</i><br>
                        <a href="https://platform.openai.com/api-keys" class="link" target="_blank">Get an OpenAI API key</a>
                    </div>
                    <div class="btn-row">
                        <button id="test-api" class="btn btn-secondary">Test API</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Prompt History Section -->
    <div class="section" id="history-section">
      <div class="section-header">
        <div>
          <div class="section-title">üìã Prompt History</div>
          <div class="section-subtitle">View prompts used to generate cards</div>
        </div>
        <span class="section-toggle" tabindex="0" aria-label="Toggle section">‚ñæ</span>
      </div>
      <div class="section-body-wrapper">
        <div class="section-body">
          <div class="section-body-content">
            <div class="history-controls">
                <div id="clear-history-action-area">
                    <button id="clear-history-btn" class="btn btn-secondary">Clear History</button>
                </div>
                <div id="confirm-clear-history-area" style="display: none;">
                    <span class="confirm-message">Are you sure? This cannot be undone.</span>
                    <button id="confirm-clear-btn" class="btn btn-primary error">Yes, Clear All</button>
                    <button id="cancel-clear-btn" class="btn btn-secondary">Cancel</button>
                </div>
                <span class="history-count" id="history-count"></span>
            </div>
            <div class="history-list" id="history-list">
              <!-- Example entry structure -->
              <div class="history-entry">
                <div class="history-header">
                  <!-- ...header content... -->
                </div>
                <div class="history-details">
                  <div class="history-detail-row">
                    <div class="history-detail-label">Prompt:</div>
                    <!-- ...prompt content... -->
                  </div>
                  <!-- ...other detail rows... -->
                </div>
              </div>
              <!-- ...repeat for each entry... -->
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- PDF Review Section -->
    <div class="section" id="pdf-review-section">
        <div class="section-header">
            <div>
                <div class="section-title">üìÑ PDF Cards for Review</div>
                <div class="section-subtitle">
                    Edit and save cards created from PDF selections<br>
                    <span class="help-text" style="font-size: 13px;">
                        Whether PDF cards go here or auto-save depends on the global <b>Always review cards</b> setting above.
                    </span>
                </div>
            </div>
            <span class="section-toggle" tabindex="0" aria-label="Toggle section">‚ñæ</span>
        </div>
        <div class="section-body-wrapper">
            <div class="section-body" id="pdf-review-body">
                <div class="section-body-content">
                    <div class="history-controls">
                        <button id="refresh-pdf-review-list-btn" class="btn btn-secondary">Refresh List</button>
                        <button id="clear-all-pdf-review-btn" class="btn btn-secondary error">Clear All Review Cards</button>
                        <span class="history-count" id="pdf-review-count">0 cards for review</span>
                    </div>
                    <p class="help-text" style="margin-bottom: var(--gap-sm);">
                        Note: PDF-sourced cards appear here for review if the global "Always review cards before saving" setting (in GPT Settings above) is enabled, or if automatic processing encountered an issue. If that setting is disabled and processing is successful, PDF cards are sent directly to Anki (or the sync queue) with a system notification.
                    </p>
                    <div id="pdf-review-list" class="history-list">
                        <div style="text-align: center; color: var(--muted); padding: 20px;">Loading PDF cards for review...</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="footer">
      <a href="https://github.com/zawrick/zawrick/issues" target="_blank" rel="noopener" class="footer-link">üêû Report a bug</a>
      <button type="button" id="reset-settings" class="footer-link">Reset settings</button>
    </div>

    <script src="options.js" defer></script>
    <script src="options_ui.js" defer></script>
</body>
</html>